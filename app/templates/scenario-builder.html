<template id="template-scenario-builder">
  <div>

    <!-- the grey toolbar for scenario builder -->
    <nav class="navbar navbar-default navbar-static-top tool-bar ">
      <div class="container-fluid">
        <div class="row" >
          <div class="col-xs-12">
            <div class="btn-toolbar">
              <!-- mixed button and a tags will be fixed soon! -->
              <button class=" btn btn-primary" id="scenario-submit" v-on:click="submitScenario" value="" v-bind:class="{ 'inputdisabled': formIsValid == false ||  this.totalRuns > 20}" >
                Save
              </button>

              <a href="#/" class="btn btn-primary pull-left">Cancel</a>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- User has to select a template first -->

    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-12">
          <h2>Scenario builder</h2>
        </div>
      </div>

      <div class="row">
        <!-- 2 column layout, 1st column scenario properties -->
        <div class="col-sm-5">
          <!--  -->
          <div class="row" v-if="availableTemplates.length">
            <div class="col-sm-12">
              <div class="form-group ">
                <label for="select-template">Select a template</label>
                <select class="combobox form-control" v-model="template"  id="select-template">
                  <option v-for="template in availableTemplates" v-bind:value="template">
                    {{ template.name }}
                  </option>
                </select>
              </div>
            </div>
          </div>

          <!-- if user selected something, show GUI -->
          <div>
            <div>
              <!-- the vue validator config, stores form validation result in validation -->
              <validator name="validation">
                <form novalidate>
                  <div v-for="section in scenarioConfig.sections">
                    <div class="panel panel-default">
                      <div class="panel-heading">
                        <h3 class="panel-title">{{section.label}}</h3>
                      </div>
                      <div class="panel-body">
                        <div class="form-group" v-for="variable in section.variables" v-bind:class="{'.has-success': variable.variableid === 'scenarioname'}">
                          <label class="control-label" for="{{variable.id}}">
                            {{ variable.name }}
                            <span class="glyphicon glyphicon-info-sign" data-toggle="tooltip" data-placement="right" title="{{variable.description}}" v-if="variable.description"></span>
                            <span v-for="validator in variable.validators" v-if="validator.type === 'range'">
                              [{{ validator.min }} - {{ validator.max }}]
                            </span>
                          </label>
                          <div class="input-group">
                            <template v-if="variable.type !== 'textarea'">
                              <input

                                 type="{{ variable.type }}"
                                 class="form-control"
                                 id="{{ variable.id }}"
                                 :data-role="variable.factor ? 'tagsinput' : ''"
                                 v-model="variable.value"
                                 :disabled="variable.disabled"
                                 aria-describedby="{{ variable.variableid }}status"
                                 >
                            </template>
                            <textarea
                               class="form-control"
                               rows="3"
                               v-if="variable.type === 'textarea'"
                               :disabled="variable.disabled"
                               >{{ variable.value }}</textarea>
                            <!-- if we add this to 1 we need to add it to all, bug in bootstrap -->
                            <span class="input-group-addon">
                              {{ variable.units || '-' }}
                            </span>

                          </div>
                          <div class="errors">
                          </div>

                          <span id="{{ variable.variableid }}status" class="sr-only">(success)</span>
                          <!-- <pre> -->
                          <!--   {{ variable | json }} -->
                          <!-- </pre> -->
                        </div>


                      </div>
                    </div>


                  </div>
                </form>
              </validator>
            </div>


            <!-- expected runs indicator. It becomes a different color if the totalRuns exceed 20 -->
            <div class="row" >
              <div class="col-sm-12">
                <div class="alert alert-info" v-bind:class="{ 'alert-warning': totalRuns > 20}" role="alert">
                  <p class="lead">Expected runs: <strong>~{{totalRuns}}</strong></p>
                  <p v-if="totalRuns > 20">
                    At the moment you cannot submit more than 20 runs in one scenario.
                  </p>

                </div>
              </div>
            </div>

          </div>



        </div>


        <div class="col-sm-7">
          <div v-if="template">
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">Template details</h3>
              </div>
              <!-- template details -->
              <div class="panel-body">
                <dl class="dl-horizontal">
                  <dt>Name</dt>
                  <dd>{{template.templatename}}</dd>
                  <dt>Email</dt>
                  <dd>{{ template.email }}</dd>
                  <dt>Site</dt>
                  <dd>{{ template.site }}</dd>
                  <dt>Description</dt>
                  <dd>{{ template.description }}</dd>
                  <dt>Version</dt>
                  <dd>{{ template.version}}</dd>
                </dl>
              </div>
            </div>
            <div class="panel panel-default">
              <div class="panel-heading">
                <h3 class="panel-title">Schematic</h3>
              </div>
              <!-- template details -->
              <div class="panel-body  text-center">
                <img src="images/schematic.svg" class="scenariobuilder-schematic" />
              </div>
            </div>
          </div>



        </div>
      </div>
    </div>
  </div>
</template>
